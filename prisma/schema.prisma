// Prisma schema for Job Application System
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserProfile {
  id                Int      @id @default(autoincrement())
  name              String
  email             String   @unique
  phone             String?
  experienceSummary String?
  skills            String[] @default([])
  salaryPreference  String?
  baseResumePath    String?   // stored file path in S3 or local
  baseResumeJson    Json?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  resumes           Resume[]
  applications      Application[]
}

model Resume {
  id           Int       @id @default(autoincrement())
  ownerId      Int
  owner        UserProfile @relation(fields: [ownerId], references: [id])
  originJobId  Int?
  originJob    Job?       @relation(fields: [originJobId], references: [id])
  filePath     String     // S3 or local path
  variantMeta  Json?
  llmModel     String?
  createdAt    DateTime   @default(now())

  applications Application[]
}

model Job {
  id            Int      @id @default(autoincrement())
  platform      String   // linkedin | naukri | indeed | other
  url           String   @unique
  title         String?
  company       String?
  location      String?
  experience    String?
  description   String?
  skills        String[] @default([])
  jdSchema      Json?    // normalized JD structure
  createdAt     DateTime @default(now())

  applications  Application[]
  resumes       Resume[]
}

model Application {
  id            Int      @id @default(autoincrement())
  jobId         Int
  job           Job      @relation(fields: [jobId], references: [id])
  resumeId      Int?
  resume        Resume?  @relation(fields: [resumeId], references: [id])
  userId        Int?
  user          UserProfile? @relation(fields: [userId], references: [id])
  platform      String
  date          DateTime @default(now())
  notes         String?
  status        ApplicationStatus @default(SAVED)
  createdAt     DateTime @default(now())
}

model Log {
  id        Int      @id @default(autoincrement())
  level     String   // info | warn | error
  message   String
  context   Json?
  createdAt DateTime @default(now())
}

model Notification {
  id        Int      @id @default(autoincrement())
  type      String   // resume_generated | application_submitted | scraper_error | auto_apply_error
  message   String
  meta      Json?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
}

enum ApplicationStatus {
  SAVED
  APPLIED
  IN_PROGRESS
  IN_REVIEW
  REJECTED
  GHOSTED
  SHORTLISTED
}
